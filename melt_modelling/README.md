# Melt Modelling

## Contents
- `Katz-Shorttle_melt-paths_pyMelt.py`: pyMelt script to generate melting curves at different mantle Tp
- `resample_melt-paths.sh`: shell script to resample pyMelt results at regular depth intervals and generate one lookup table for all melting curves
- `melt_paths`: folder with example files generated by `Katz-Shorttle_melt-paths_pyMelt.py` and `resample_melt-paths.sh`
- `input_forward_model.dat`: template INVMEL-v12 input file that was used to generate the forward models in `INVMEL_Katz-Shorttle_0-100`
- `INVMEL_Katz-Shorttle_0-100`: folder containing results of INVMEL-v12 forward model runs at varying Tp, zL and source composition
- `invmel_misfit-minimisation.py`: rms misfit minimisation for Yilgarn low-Th basalts (output: `invmel_misfit_best.dat`)

## Step 1: generate melt paths for different mantle sources at variable mantle potential temperature

- `Katz-Shorttle_melt-paths_pyMelt.py`: run pyMelt with the parameterisation of Katz et al. (2003), with modified parameters from Shorttle et al. (2014).
- output is saved to the folder `melt_paths`; one example file for Tp=1450°C and bulk_H2O=0.02 has been included. H2O content was calculated from the Ce content of different source compositions (mixtures between primitive and depleted peridotite compositions from McKenzie & O'Nions, 1991).
- use `resample_melt-paths.sh` to resample all melt paths at 1km depth intervals and save to a single lookup table; a resamples melt path for Tp=1450°C and bulk_H2O=0.02 has also been included in the folder `melt_paths`.

## Step 2: run INVMEL-v12 forward models

The INVMEL software was developed and is owned by D. McKenzie to whom requests for access should be directed (McKenzie & O'Nions, 1991).

`input_forward_model.dat` is a template input file to run INVMEL-v12 as a forward model only. This template was used to generate forward models of melt composition at varying Tp (mantle potential temperature) and zL (depth to the top pf the melting column), in a parameter sweep based on the lookup table from step 1. 
The parameter sweep is a variation on this <https://github.com/mk618/invmel-wrapper> and is not included here.

Forward model results are saved according to their source composition to subfolders within `INVMEL_Katz-Shorttle_0-100`. 

## Step 3: rms misfit minimisation for observed melt composition

`invmel_misfit-minimisation.py` computes the minimum rms misfit for Yilgarn low-Th basalts:
- input: `../data_filtering/Results_15kbar_cpx93fo93_Langmuir_traces-O.csv`
- output: `invmel_misfit_best.dat`

Two misfit calculations are performed: one using all 13 REEs, and one with only 4 REEs that are evenly distributed in terms of relative incompatibility (in order to avoid biasing the misfit towards parts of the overall REE pattern).


## References


Katz, R. F., M. Spiegelman, and C. H. Langmuir (2003), A new parameterization of hydrous mantle melting, Geochem. Geophys. Geosyst., 4, 1073, https://doi.org/10.1029/2002GC000433, 9.

Matthews, S., Wong, K., and Gleeson, M. (2022) “pyMelt: An extensible Python engine for mantle melting calculations”, Volcanica, 5(2), pp. 469–475.  https://doi.org/10.30909/vol.05.02.469475.

McKenzie, D., and O'Nions, R. K. (1991). Partial Melt Distributions from Inversion of Rare Earth Element Concentrations, Journal of Petrology 32(5), 1021–1091, https://doi.org/10.1093/petrology/32.5.1021.

Shorttle, O., Maclennan, J., and Lambart, S. (2014). Quantifying lithological variability in the mantle. Earth and Planetary Science Letters, 395, 24–40. https://doi.org/10.1016/j.epsl.2014.03.040.
